"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.methods = void 0;
exports.load = load;
exports.unload = unload;
exports.onAssetMenu = onAssetMenu;
const path_1 = __importDefault(require("path"));
const fs_extra_1 = __importDefault(require("fs-extra"));
/**
 * @en Registration method for the main process of Extension
 * @zh 为扩展的主进程的注册方法
 */
exports.methods = {
    /**
     * @en A method that can be triggered by message
     * @zh 通过 message 触发的方法
     */
    showLog() {
        console.log('Hello World');
    },
};
const AutoAltasPatch = fs_extra_1.default.readFileSync(path_1.default.join(__dirname, '..', 'res', 'AutoAtlasPatch.txt'), 'utf-8');
async function refreshPac(assetInfo) {
    // console.log(assetInfo);
    let pacDir = path_1.default.dirname(assetInfo.url);
    let spriteFrameFormat = pacDir + "/**/*.png";
    let subImgs = await Editor.Message.request("asset-db", "query-assets", { pattern: spriteFrameFormat });
    let destPath = path_1.default.join(Editor.Project.path, "library", assetInfo.uuid.substring(0, 2), assetInfo.uuid + ".json");
    var data = fs_extra_1.default.readFileSync(destPath);
    var pacConfig = JSON.parse(data.toString());
    pacConfig.content.spriteFrames = [];
    for (let j = 0; j < subImgs.length; j++) {
        let subImg = subImgs[j];
        if (subImg.subAssets && subImg.subAssets["f9941"]) {
            pacConfig.content.spriteFrames.push(subImg.subAssets["f9941"].displayName);
            pacConfig.content.spriteFrames.push(subImg.subAssets["f9941"].uuid);
        }
    }
    fs_extra_1.default.writeFileSync(destPath, JSON.stringify(pacConfig));
    let uuidTempPath = path_1.default.join(Editor.Project.path, 'temp', 'asset-db', 'assets', assetInfo.uuid.substring(0, 2), assetInfo.uuid);
    if (!fs_extra_1.default.existsSync(uuidTempPath)) {
        console.error('未查找到预览文件，请确保预览后再执行此操作');
        return;
    }
    let dirs = fs_extra_1.default.readdirSync(uuidTempPath);
    let buildPath = dirs.find(dir => dir.startsWith('build') && fs_extra_1.default.existsSync(path_1.default.join(uuidTempPath, dir, 'preview', 'texture-packer', 'preview')));
    if (!buildPath) {
        console.error('未查找到预览文件，请确保预览后再执行此操作');
        return;
    }
    let previewPath = path_1.default.join(uuidTempPath, buildPath, 'preview', 'texture-packer', 'preview');
    if (!fs_extra_1.default.existsSync(previewPath)) {
        console.error('未查找到预览文件，请确保预览后再执行此操作');
        return;
    }
    let temp = path_1.default.join(Editor.Project.path, 'assets', 'auto_atlas_temp');
    if (!fs_extra_1.default.existsSync(temp)) {
        fs_extra_1.default.mkdirSync(temp);
        // console.warn('请将temp文件夹添加到bundle过滤配置中');
        let tempUrl = temp.replace(Editor.Project.path, '');
        tempUrl = tempUrl.replace(/\\/g, '/');
        tempUrl = 'db://' + tempUrl.replace('/', '');
        // console.warn(tempUrl);
        await Editor.Message.request('asset-db', 'refresh-asset', tempUrl);
        let metaPath = temp + '.meta';
        if (fs_extra_1.default.existsSync(metaPath)) {
            let meta = fs_extra_1.default.readFileSync(metaPath);
            let metaJson = JSON.parse(meta.toString());
            if (!metaJson.userData) {
                metaJson.userData = {};
            }
            metaJson.userData.isBundle = true;
            fs_extra_1.default.writeFileSync(metaPath, JSON.stringify(metaJson));
            await Editor.Message.request('asset-db', 'refresh-asset', tempUrl);
        }
    }
    let scriptsPath = path_1.default.join(temp, 'scripts');
    if (!fs_extra_1.default.existsSync(scriptsPath)) {
        fs_extra_1.default.mkdirSync(scriptsPath);
    }
    let patchPath = path_1.default.join(scriptsPath, 'AutoAtlasPatch.ts');
    let code = '';
    if (!fs_extra_1.default.existsSync(patchPath)) {
        code = AutoAltasPatch;
    }
    else {
        code = fs_extra_1.default.readFileSync(patchPath, 'utf-8');
    }
    // 查找图集
    let pacFormat = "db://assets/**/*.pac";
    let pacs = await Editor.Message.request("asset-db", "query-assets", { pattern: pacFormat });
    // 生成新的uuids数组字符串
    let newUuidsStr = pacs.map(pac => {
        return `{ uuid: '${pac.uuid}' }`;
    }).join(', ');
    // 替换代码中的uuids数组
    let uuidPattern = /let\s+uuids\s*=\s*\[(.*?)\]/;
    code = code.replace(uuidPattern, `let uuids = [${newUuidsStr}]`);
    fs_extra_1.default.writeFileSync(patchPath, code);
    // 删除atlas中的无用资源
    let atlasDirs = fs_extra_1.default.readdirSync(path_1.default.join(temp, 'atlas'));
    atlasDirs.forEach(dir => {
        if (!pacs.find(pac => pac.uuid === dir) && !dir.endsWith('.meta')) {
            fs_extra_1.default.removeSync(path_1.default.join(temp, 'atlas', dir));
            fs_extra_1.default.removeSync(path_1.default.join(temp, 'atlas', dir + '.meta'));
        }
    });
    Editor.Message.request('asset-db', 'refresh-asset', 'db://assets/auto_atlas_temp/scripts/AutoAtlasPatch.ts');
    uuidTempPath = path_1.default.join(temp, 'atlas', assetInfo.uuid);
    if (!fs_extra_1.default.existsSync(uuidTempPath)) {
        fs_extra_1.default.mkdirSync(uuidTempPath, { recursive: true });
    }
    fs_extra_1.default.copySync(previewPath, uuidTempPath, { overwrite: true });
    let imgDir = fs_extra_1.default.readdirSync(path_1.default.join(temp, 'atlas', assetInfo.uuid));
    let pacInfo = path_1.default.join(temp, 'atlas', assetInfo.uuid, 'pac-info.json');
    let pacInfoData = JSON.parse(fs_extra_1.default.readFileSync(pacInfo, 'utf-8'));
    let atlases = pacInfoData.result.atlases;
    // for (let atlas of atlases) {
    //     let imageUuid = atlas.imageUuid;
    // }
    imgDir.forEach((img) => {
        if (!img.endsWith('.png')) {
            return;
        }
        if (!atlases.find(atlas => atlas.imageUuid === path_1.default.basename(img, '.png'))) {
            fs_extra_1.default.removeSync(path_1.default.join(temp, 'atlas', assetInfo.uuid, img));
            fs_extra_1.default.removeSync(path_1.default.join(temp, 'atlas', assetInfo.uuid, img + '.meta'));
        }
    });
    let tempUrl = await Editor.Message.request('asset-db', 'query-url', temp);
    await Editor.Message.request('asset-db', 'refresh-asset', tempUrl);
    console.log(`${assetInfo.url}自动图集刷新成功（请确保预览后再执行此操作）`);
}
/**
 * @en Method Triggered on Extension Startup
 * @zh 扩展启动时触发的方法
 */
function load() { }
/**
 * @en Method triggered when uninstalling the extension
 * @zh 卸载扩展时触发的方法
 */
function unload() { }
function onAssetMenu(assetInfo) {
    return [
        {
            label: '刷新自动图集',
            visible: assetInfo.importer == 'auto-atlas',
            click() {
                refreshPac(assetInfo);
            }
        }
    ];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NvdXJjZS9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQW9KQSxvQkFBMEI7QUFNMUIsd0JBQTRCO0FBRzVCLGtDQVVDO0FBdEtELGdEQUF3QjtBQUN4Qix3REFBMEI7QUFFMUI7OztHQUdHO0FBQ1UsUUFBQSxPQUFPLEdBQTRDO0lBQzVEOzs7T0FHRztJQUNILE9BQU87UUFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQy9CLENBQUM7Q0FDSixDQUFDO0FBR0YsTUFBTSxjQUFjLEdBQUcsa0JBQUUsQ0FBQyxZQUFZLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxvQkFBb0IsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBR3pHLEtBQUssVUFBVSxVQUFVLENBQUMsU0FBb0I7SUFDMUMsMEJBQTBCO0lBQzFCLElBQUksTUFBTSxHQUFHLGNBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pDLElBQUksaUJBQWlCLEdBQUcsTUFBTSxHQUFHLFdBQVcsQ0FBQztJQUM3QyxJQUFJLE9BQU8sR0FBRyxNQUFNLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxjQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO0lBRXZHLElBQUksUUFBUSxHQUFHLGNBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxDQUFDO0lBQ25ILElBQUksSUFBSSxHQUFHLGtCQUFFLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FB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T0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxHQUFHLHdCQUF3QixDQUFDLENBQUM7QUFDMUQsQ0FBQztBQUNEOzs7R0FHRztBQUNILFNBQWdCLElBQUksS0FBSyxDQUFDO0FBRTFCOzs7R0FHRztBQUNILFNBQWdCLE1BQU0sS0FBSyxDQUFDO0FBRzVCLFNBQWdCLFdBQVcsQ0FBQyxTQUFvQjtJQUM1QyxPQUFPO1FBQ0g7WUFDSSxLQUFLLEVBQUUsUUFBUTtZQUNmLE9BQU8sRUFBRSxTQUFTLENBQUMsUUFBUSxJQUFJLFlBQVk7WUFDM0MsS0FBSztnQkFDRCxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUE7WUFDekIsQ0FBQztTQUNKO0tBQ0osQ0FBQztBQUNOLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3NldEluZm8gfSBmcm9tIFwiQGNvY29zL2NyZWF0b3ItdHlwZXMvZWRpdG9yL3BhY2thZ2VzL2Fzc2V0LWRiL0B0eXBlcy9wdWJsaWNcIjtcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XHJcblxyXG4vKipcclxuICogQGVuIFJlZ2lzdHJhdGlvbiBtZXRob2QgZm9yIHRoZSBtYWluIHByb2Nlc3Mgb2YgRXh0ZW5zaW9uXHJcbiAqIEB6aCDkuLrmianlsZXnmoTkuLvov5vnqIvnmoTms6jlhozmlrnms5VcclxuICovXHJcbmV4cG9ydCBjb25zdCBtZXRob2RzOiB7IFtrZXk6IHN0cmluZ106ICguLi5hbnk6IGFueSkgPT4gYW55IH0gPSB7XHJcbiAgICAvKipcclxuICAgICAqIEBlbiBBIG1ldGhvZCB0aGF0IGNhbiBiZSB0cmlnZ2VyZWQgYnkgbWVzc2FnZVxyXG4gICAgICogQHpoIOmAmui/hyBtZXNzYWdlIOinpuWPkeeahOaWueazlVxyXG4gICAgICovXHJcbiAgICBzaG93TG9nKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdIZWxsbyBXb3JsZCcpO1xyXG4gICAgfSxcclxufTtcclxuXHJcblxyXG5jb25zdCBBdXRvQWx0YXNQYXRjaCA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAncmVzJywgJ0F1dG9BdGxhc1BhdGNoLnR4dCcpLCAndXRmLTgnKTtcclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiByZWZyZXNoUGFjKGFzc2V0SW5mbzogQXNzZXRJbmZvKSB7XHJcbiAgICAvLyBjb25zb2xlLmxvZyhhc3NldEluZm8pO1xyXG4gICAgbGV0IHBhY0RpciA9IHBhdGguZGlybmFtZShhc3NldEluZm8udXJsKTtcclxuICAgIGxldCBzcHJpdGVGcmFtZUZvcm1hdCA9IHBhY0RpciArIFwiLyoqLyoucG5nXCI7XHJcbiAgICBsZXQgc3ViSW1ncyA9IGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoXCJhc3NldC1kYlwiLCBcInF1ZXJ5LWFzc2V0c1wiLCB7IHBhdHRlcm46IHNwcml0ZUZyYW1lRm9ybWF0IH0pO1xyXG5cclxuICAgIGxldCBkZXN0UGF0aCA9IHBhdGguam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCBcImxpYnJhcnlcIiwgYXNzZXRJbmZvLnV1aWQuc3Vic3RyaW5nKDAsIDIpLCBhc3NldEluZm8udXVpZCArIFwiLmpzb25cIik7XHJcbiAgICB2YXIgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhkZXN0UGF0aCk7XHJcbiAgICB2YXIgcGFjQ29uZmlnID0gSlNPTi5wYXJzZShkYXRhLnRvU3RyaW5nKCkpO1xyXG4gICAgcGFjQ29uZmlnLmNvbnRlbnQuc3ByaXRlRnJhbWVzID0gW107XHJcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHN1YkltZ3MubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICBsZXQgc3ViSW1nID0gc3ViSW1nc1tqXTtcclxuICAgICAgICBpZiAoc3ViSW1nLnN1YkFzc2V0cyAmJiBzdWJJbWcuc3ViQXNzZXRzW1wiZjk5NDFcIl0pIHtcclxuICAgICAgICAgICAgcGFjQ29uZmlnLmNvbnRlbnQuc3ByaXRlRnJhbWVzLnB1c2goc3ViSW1nLnN1YkFzc2V0c1tcImY5OTQxXCJdLmRpc3BsYXlOYW1lKTtcclxuICAgICAgICAgICAgcGFjQ29uZmlnLmNvbnRlbnQuc3ByaXRlRnJhbWVzLnB1c2goc3ViSW1nLnN1YkFzc2V0c1tcImY5OTQxXCJdLnV1aWQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZzLndyaXRlRmlsZVN5bmMoZGVzdFBhdGgsIEpTT04uc3RyaW5naWZ5KHBhY0NvbmZpZykpO1xyXG5cclxuICAgIGxldCB1dWlkVGVtcFBhdGggPSBwYXRoLmpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgJ3RlbXAnLCAnYXNzZXQtZGInLCAnYXNzZXRzJywgYXNzZXRJbmZvLnV1aWQuc3Vic3RyaW5nKDAsIDIpLCBhc3NldEluZm8udXVpZCk7XHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmModXVpZFRlbXBQYXRoKSkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+acquafpeaJvuWIsOmihOiniOaWh+S7tu+8jOivt+ehruS/nemihOiniOWQjuWGjeaJp+ihjOatpOaTjeS9nCcpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxldCBkaXJzID0gZnMucmVhZGRpclN5bmModXVpZFRlbXBQYXRoKTtcclxuICAgIGxldCBidWlsZFBhdGggPSBkaXJzLmZpbmQoZGlyID0+IGRpci5zdGFydHNXaXRoKCdidWlsZCcpICYmIGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHV1aWRUZW1wUGF0aCwgZGlyLCAncHJldmlldycsICd0ZXh0dXJlLXBhY2tlcicsICdwcmV2aWV3JykpKTtcclxuICAgIGlmICghYnVpbGRQYXRoKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign5pyq5p+l5om+5Yiw6aKE6KeI5paH5Lu277yM6K+356Gu5L+d6aKE6KeI5ZCO5YaN5omn6KGM5q2k5pON5L2cJyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbGV0IHByZXZpZXdQYXRoID0gcGF0aC5qb2luKHV1aWRUZW1wUGF0aCwgYnVpbGRQYXRoLCAncHJldmlldycsICd0ZXh0dXJlLXBhY2tlcicsICdwcmV2aWV3Jyk7XHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMocHJldmlld1BhdGgpKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcign5pyq5p+l5om+5Yiw6aKE6KeI5paH5Lu277yM6K+356Gu5L+d6aKE6KeI5ZCO5YaN5omn6KGM5q2k5pON5L2cJyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB0ZW1wID0gcGF0aC5qb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsICdhc3NldHMnLCAnYXV0b19hdGxhc190ZW1wJyk7XHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmModGVtcCkpIHtcclxuICAgICAgICBmcy5ta2RpclN5bmModGVtcCk7XHJcbiAgICAgICAgLy8gY29uc29sZS53YXJuKCfor7flsIZ0ZW1w5paH5Lu25aS55re75Yqg5YiwYnVuZGxl6L+H5ruk6YWN572u5LitJyk7XHJcbiAgICAgICAgbGV0IHRlbXBVcmwgPSB0ZW1wLnJlcGxhY2UoRWRpdG9yLlByb2plY3QucGF0aCwgJycpO1xyXG4gICAgICAgIHRlbXBVcmwgPSB0ZW1wVXJsLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcclxuICAgICAgICB0ZW1wVXJsID0gJ2RiOi8vJyArIHRlbXBVcmwucmVwbGFjZSgnLycsICcnKTtcclxuICAgICAgICAvLyBjb25zb2xlLndhcm4odGVtcFVybCk7XHJcbiAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncmVmcmVzaC1hc3NldCcsIHRlbXBVcmwpO1xyXG4gICAgICAgIGxldCBtZXRhUGF0aCA9IHRlbXAgKyAnLm1ldGEnO1xyXG4gICAgICAgIGlmIChmcy5leGlzdHNTeW5jKG1ldGFQYXRoKSkge1xyXG4gICAgICAgICAgICBsZXQgbWV0YSA9IGZzLnJlYWRGaWxlU3luYyhtZXRhUGF0aCk7XHJcbiAgICAgICAgICAgIGxldCBtZXRhSnNvbiA9IEpTT04ucGFyc2UobWV0YS50b1N0cmluZygpKTtcclxuICAgICAgICAgICAgaWYgKCFtZXRhSnNvbi51c2VyRGF0YSkge1xyXG4gICAgICAgICAgICAgICAgbWV0YUpzb24udXNlckRhdGEgPSB7fTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtZXRhSnNvbi51c2VyRGF0YS5pc0J1bmRsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMobWV0YVBhdGgsIEpTT04uc3RyaW5naWZ5KG1ldGFKc29uKSk7XHJcbiAgICAgICAgICAgIGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ3JlZnJlc2gtYXNzZXQnLCB0ZW1wVXJsKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHNjcmlwdHNQYXRoID0gcGF0aC5qb2luKHRlbXAsICdzY3JpcHRzJyk7XHJcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoc2NyaXB0c1BhdGgpKSB7XHJcbiAgICAgICAgZnMubWtkaXJTeW5jKHNjcmlwdHNQYXRoKTtcclxuICAgIH1cclxuICAgIGxldCBwYXRjaFBhdGggPSBwYXRoLmpvaW4oc2NyaXB0c1BhdGgsICdBdXRvQXRsYXNQYXRjaC50cycpO1xyXG4gICAgbGV0IGNvZGUgPSAnJztcclxuICAgIGlmICghZnMuZXhpc3RzU3luYyhwYXRjaFBhdGgpKSB7XHJcbiAgICAgICAgY29kZSA9IEF1dG9BbHRhc1BhdGNoO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb2RlID0gZnMucmVhZEZpbGVTeW5jKHBhdGNoUGF0aCwgJ3V0Zi04Jyk7XHJcbiAgICB9XHJcbiAgICAvLyDmn6Xmib7lm77pm4ZcclxuICAgIGxldCBwYWNGb3JtYXQgPSBcImRiOi8vYXNzZXRzLyoqLyoucGFjXCI7XHJcbiAgICBsZXQgcGFjcyA9IGF3YWl0IEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoXCJhc3NldC1kYlwiLCBcInF1ZXJ5LWFzc2V0c1wiLCB7IHBhdHRlcm46IHBhY0Zvcm1hdCB9KTtcclxuXHJcbiAgICAvLyDnlJ/miJDmlrDnmoR1dWlkc+aVsOe7hOWtl+espuS4slxyXG4gICAgbGV0IG5ld1V1aWRzU3RyID0gcGFjcy5tYXAocGFjID0+IHtcclxuICAgICAgICByZXR1cm4gYHsgdXVpZDogJyR7cGFjLnV1aWR9JyB9YFxyXG4gICAgfSkuam9pbignLCAnKTtcclxuXHJcbiAgICAvLyDmm7/mjaLku6PnoIHkuK3nmoR1dWlkc+aVsOe7hFxyXG4gICAgbGV0IHV1aWRQYXR0ZXJuID0gL2xldFxccyt1dWlkc1xccyo9XFxzKlxcWyguKj8pXFxdLztcclxuICAgIGNvZGUgPSBjb2RlLnJlcGxhY2UodXVpZFBhdHRlcm4sIGBsZXQgdXVpZHMgPSBbJHtuZXdVdWlkc1N0cn1dYCk7XHJcbiAgICBmcy53cml0ZUZpbGVTeW5jKHBhdGNoUGF0aCwgY29kZSk7XHJcblxyXG4gICAgLy8g5Yig6ZmkYXRsYXPkuK3nmoTml6DnlKjotYTmupBcclxuICAgIGxldCBhdGxhc0RpcnMgPSBmcy5yZWFkZGlyU3luYyhwYXRoLmpvaW4odGVtcCwgJ2F0bGFzJykpO1xyXG4gICAgYXRsYXNEaXJzLmZvckVhY2goZGlyID0+IHtcclxuICAgICAgICBpZiAoIXBhY3MuZmluZChwYWMgPT4gcGFjLnV1aWQgPT09IGRpcikgJiYgIWRpci5lbmRzV2l0aCgnLm1ldGEnKSkge1xyXG4gICAgICAgICAgICBmcy5yZW1vdmVTeW5jKHBhdGguam9pbih0ZW1wLCAnYXRsYXMnLCBkaXIpKTtcclxuICAgICAgICAgICAgZnMucmVtb3ZlU3luYyhwYXRoLmpvaW4odGVtcCwgJ2F0bGFzJywgZGlyICsgJy5tZXRhJykpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ3JlZnJlc2gtYXNzZXQnLCAnZGI6Ly9hc3NldHMvYXV0b19hdGxhc190ZW1wL3NjcmlwdHMvQXV0b0F0bGFzUGF0Y2gudHMnKTtcclxuXHJcbiAgICB1dWlkVGVtcFBhdGggPSBwYXRoLmpvaW4odGVtcCwgJ2F0bGFzJywgYXNzZXRJbmZvLnV1aWQpO1xyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKHV1aWRUZW1wUGF0aCkpIHtcclxuICAgICAgICBmcy5ta2RpclN5bmModXVpZFRlbXBQYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcclxuICAgIH1cclxuICAgIGZzLmNvcHlTeW5jKHByZXZpZXdQYXRoLCB1dWlkVGVtcFBhdGgsIHsgb3ZlcndyaXRlOiB0cnVlIH0pO1xyXG5cclxuICAgIGxldCBpbWdEaXIgPSBmcy5yZWFkZGlyU3luYyhwYXRoLmpvaW4odGVtcCwgJ2F0bGFzJywgYXNzZXRJbmZvLnV1aWQpKTtcclxuICAgIGxldCBwYWNJbmZvID0gcGF0aC5qb2luKHRlbXAsICdhdGxhcycsIGFzc2V0SW5mby51dWlkLCAncGFjLWluZm8uanNvbicpO1xyXG4gICAgbGV0IHBhY0luZm9EYXRhID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMocGFjSW5mbywgJ3V0Zi04JykpO1xyXG4gICAgbGV0IGF0bGFzZXM6IGFueVtdID0gcGFjSW5mb0RhdGEucmVzdWx0LmF0bGFzZXM7XHJcbiAgICAvLyBmb3IgKGxldCBhdGxhcyBvZiBhdGxhc2VzKSB7XHJcbiAgICAvLyAgICAgbGV0IGltYWdlVXVpZCA9IGF0bGFzLmltYWdlVXVpZDtcclxuICAgIC8vIH1cclxuICAgIGltZ0Rpci5mb3JFYWNoKChpbWcpID0+IHtcclxuICAgICAgICBpZiAoIWltZy5lbmRzV2l0aCgnLnBuZycpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFhdGxhc2VzLmZpbmQoYXRsYXMgPT4gYXRsYXMuaW1hZ2VVdWlkID09PSBwYXRoLmJhc2VuYW1lKGltZywgJy5wbmcnKSkpIHtcclxuICAgICAgICAgICAgZnMucmVtb3ZlU3luYyhwYXRoLmpvaW4odGVtcCwgJ2F0bGFzJywgYXNzZXRJbmZvLnV1aWQsIGltZykpO1xyXG4gICAgICAgICAgICBmcy5yZW1vdmVTeW5jKHBhdGguam9pbih0ZW1wLCAnYXRsYXMnLCBhc3NldEluZm8udXVpZCwgaW1nICsgJy5tZXRhJykpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGxldCB0ZW1wVXJsID0gYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncXVlcnktdXJsJywgdGVtcCkgYXMgc3RyaW5nO1xyXG4gICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAncmVmcmVzaC1hc3NldCcsIHRlbXBVcmwpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKGAke2Fzc2V0SW5mby51cmx96Ieq5Yqo5Zu+6ZuG5Yi35paw5oiQ5Yqf77yI6K+356Gu5L+d6aKE6KeI5ZCO5YaN5omn6KGM5q2k5pON5L2c77yJYCk7XHJcbn1cclxuLyoqXHJcbiAqIEBlbiBNZXRob2QgVHJpZ2dlcmVkIG9uIEV4dGVuc2lvbiBTdGFydHVwXHJcbiAqIEB6aCDmianlsZXlkK/liqjml7bop6blj5HnmoTmlrnms5VcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2FkKCkgeyB9XHJcblxyXG4vKipcclxuICogQGVuIE1ldGhvZCB0cmlnZ2VyZWQgd2hlbiB1bmluc3RhbGxpbmcgdGhlIGV4dGVuc2lvblxyXG4gKiBAemgg5Y246L295omp5bGV5pe26Kem5Y+R55qE5pa55rOVXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gdW5sb2FkKCkgeyB9XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9uQXNzZXRNZW51KGFzc2V0SW5mbzogQXNzZXRJbmZvKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgbGFiZWw6ICfliLfmlrDoh6rliqjlm77pm4YnLFxyXG4gICAgICAgICAgICB2aXNpYmxlOiBhc3NldEluZm8uaW1wb3J0ZXIgPT0gJ2F1dG8tYXRsYXMnLFxyXG4gICAgICAgICAgICBjbGljaygpIHtcclxuICAgICAgICAgICAgICAgIHJlZnJlc2hQYWMoYXNzZXRJbmZvKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgXTtcclxufVxyXG4iXX0=